<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common :: head('My Notifications')"></head>
<body>
<header th:replace="fragments/common :: nav"></header>

<main class="container">
    <h2 class="m-0">My Notifications</h2>
    <div class="mt-1">
        <form th:action="@{/student/notifications/read-all}" method="post" class="inline">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button class="btn subtle" type="submit">Mark all as read</button>
        </form>
        <a class="btn ghost" th:href="@{/student/feed}" style="margin-left:8px;">Back to feed</a>
    </div>

    <div th:if="${notifications.empty}" class="mt-2">
        <p class="help">No notifications yet.</p>
    </div>

    <div class="v-stack mt-2" th:if="${!notifications.empty}">
        <div class="card" th:each="n : ${notifications.content}" th:classappend="${!n.read} ? ' unread'">
            <div class="meta">
                <strong th:text="${n.clubName}">Club</strong>
                · <span th:text="${n.status}">PENDING</span>
                · <span th:text="${#temporals.format(n.createdAt, 'yyyy-MM-dd HH:mm')}">time</span>
            </div>
            <div th:text="${n.message}">Message...</div>
            <div class="mt-1 h-stack">
                <a class="btn ghost" th:href="@{'/clubs/' + ${n.clubId}}">View club</a>
                <form th:if="${!n.read}" th:action="@{'/student/notifications/' + ${n.id} + '/read'}" method="post" class="inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button class="btn subtle" type="submit">Mark as read</button>
                </form>
            </div>
        </div>
    </div>

    <div class="h-stack center mt-3" th:if="${notifications.totalPages > 1}">
        <a class="btn subtle" th:if="${!notifications.first}" th:href="@{/student/notifications(page=${page-1}, size=${size})}">Prev</a>
        <span>Page <strong th:text="${notifications.number + 1}"></strong> / <span th:text="${notifications.totalPages}"></span></span>
        <a class="btn subtle" th:if="${!notifications.last}" th:href="@{/student/notifications(page=${page+1}, size=${size})}">Next</a>
    </div>
</main>
</body>
</html>